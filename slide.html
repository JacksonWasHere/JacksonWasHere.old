<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>15 Slide Puzzle</title>
    <script type="text/javascript" src="p5.js"></script>
    <script src="game.js" charset="utf-8"></script>
  </head>
  <body>
    <script type="text/javascript">


var mainGame
var controls

var cellSize=60
var gameWidth=4
var gameHeight=4

var solves=[]
var startTime=0
var endTime=0
var moveCount=0
var currentTime

var solving=false
var scrambled=false

var moves=[[0,1],[0,-1],[1,0],[-1,0]]
var notation=["R ","L ","U ","D "]

function setup() {
  stroke(1)
  controls=new conts()
  mainGame=new game(gameWidth,gameHeight,cellSize)
  createCanvas(400,400)
  mainGame.drawGame()
}


function draw() {
  fill(255)
  noStroke()
  rect(0,260,350,350)
  fill(0)
  stroke(1)
  textAlign(RIGHT)
  text(getTime(),300,300)
}


function getTime() {
  return floor(solving? millis()-startTime:endTime-startTime)
}


function startSolve() {
  startTime=millis()
  solving=true
  scrambled=false
}


function endSolve(pen){
  endTime=millis()
  solving=false
  scrambled=false
  solves.push(new solve("a",floor(-startTime+endTime),"",moveCount))
  moveCount=0
}


function scramble() {
  var previousM=[0,0]
  var attempts=0
  var scram=""
  for (var i = 0; i < 80; i++) {
    var ind=floor(random()*4)
    var move=moves[ind]
    if (move[0] != -previousM[0] && move[1] != -previousM[1] && mainGame.move(move[0],move[1])) {
      scram+=notation[ind]
    } else {
      i-=1
    }
    previousM=move
    attempts++
  }
  scrambled=true
  console.log(scram);
  console.log(attempts);
}


function keyPressed() {
  if (key==controls.up) {
    mainGame.move(-1,0)
    if (scrambled) {
      startSolve()
    } else if (solving) {
      moveCount++
    }
  } else if (key==controls.left) {
    mainGame.move(0,-1)
    if (scrambled) {
      startSolve()
    } else if (solving) {
      moveCount++
    }
  } else if (key==controls.down) {
    mainGame.move(1,0)
    if (scrambled) {
      startSolve()
    } else if (solving) {
      moveCount++
    }
  } else if(key==controls.right){
    mainGame.move(0,1)
    if (scrambled) {
      startSolve()
    } else if (solving) {
      moveCount++
    }
  } else if(key==controls.scramble){
    if (!solving) {
      scramble()
      scrambled=true
    } else {
      scramble()
      scrambled=true
      endSolve("dnf")
    }
  }
  if (mainGame.isSolved() && solving) {
    endSolve()
    console.log("Test");
  }
  console.log(mainGame.isSolved());
  mainGame.drawGame()
}

    </script>
  </body>
</html>
