<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Mandelbrot</title>
    <script src="p5.js" charset="utf-8"></script>
    <script src="p5.dom.js" charset="utf-8"></script>
    <style media="screen">

    </style>
    <script type="text/javascript">
var curWid=4
var curHt=4
var curX=0
var curY=0
var curCA
var curCB
var historyz=[]
var view2
var checkCA
var checkCB
var slideCA
var slideCB
var rlog = (base,num)=>{return log(num)/log(base)}
function setup(){
  createCanvas(400,400)
  view2=createGraphics(400,400)
  slideCA=createSlider(-2,2,0)
  slideCB=createSlider(-2,2,0)
  slideCA.changed(update)
  slideCB.changed(update)
  background(255)
  view2.colorMode(HSB,100)
  view2.noStroke()
  noStroke()
  drawSet(0,0,4,4)
  console.log("Done");
}
function draw(){
  background(0,0)
  fill(0,100,50,50)
  image(view2,0,0)
  rect(mouseX-100,mouseY-100,200,200)
}
function update(){
  drawSet(curX,curY,curWid,curHt)
}
function drawSet2(newCA,newCB){
  var x=curX,y=curY,w=curWid,h=curHt
  for (var i = 0; i < width; i++) {
    for (var j = 0; j < height; j++) {
      var a=map(i,0,width,x-w/2,x+w/2)
      var b=map(j,0,height,y-h/2,y+h/2)
      var ca=newCA
      var cb=newCB
      var n=0
      while(n<100){
        var aa=a*a-b*b
        var bb=2*a*b
        var aa2=aa+ca
        var bb2=bb+cb
        a=aa2
        b=bb2
        n++
        if(abs(a+b)>16){
          break;
        }
      }
      if(n==100){
        view2.fill(0);
      } else {
        view2.fill(n,100,100)
      }
      view2.rect(i,j,1,1);
    }
  }
}
function drawSet(x,y,w,h){
  var cca=slideCA.value()
  var ccb=slideCB.value()
  for (var i = 0; i < width; i++) {
    for (var j = 0; j < height; j++) {
      var a=map(i,0,width,x-w/2,x+w/2)
      var b=map(j,0,height,y-h/2,y+h/2)
      // -0.8+0.156i
      var ca=cca
      var cb=ccb
      var n=0
      while(n<100){
        var aa=a*a-b*b
        var bb=2*a*b
        var aa2=aa+ca
        var bb2=bb+cb
        a=aa2
        b=bb2
        n++
        if(abs(a+b)>16){
          break;
        }
      }
      if(n==100){
        view2.fill(0);
      } else {
        view2.fill(n,100,100)
      }
      view2.rect(i,j,1,1);
    }
  }
}
function keyPressed(){
  oldPos=historyz.pop()
  console.log(oldPos);
  if(oldPos!=undefined){
    curWid*=2
    curHt*=2
    curX=oldPos.x
    curY=oldPos.y
    drawSet(curX,curY,curWid,curHt,-0.8,0.156)
  }
}
function mousePressed() {
  if(!(mouseX>width || mouseX<0 || mouseY>height || mouseY<0)){
    var nx=map(mouseX,0,width,curX-curWid/2,curX+curWid/2)
    var ny=map(mouseY,0,height,curY-curHt/2,curY+curHt/2)
    curWid/=2
    curHt/=2
    historyz.push({"x":curX,"y":curY})
    console.log(historyz);
    curX=nx
    curY=ny
    console.log(curX+", "+curY);
    drawSet(nx,ny,curWid,curHt)
  }
}
    </script>
  </head>
  <body>

  </body>
</html>
